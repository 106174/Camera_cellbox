<Window x:Class="Camera_Organoids.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:Camera_Organoids"
        xmlns:lvc="clr-namespace:LiveCharts.Wpf;assembly=LiveCharts.Wpf"
        mc:Ignorable="d"
        Title="MainWindow" Height="1200" Width="2400">
    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="350"/>
            <ColumnDefinition Width="1000"/>
        </Grid.ColumnDefinitions>

        <Image Name="CameraView" Stretch="Uniform" Grid.Row="0" Grid.Column="0" />

        <StackPanel Grid.Row="1" Grid.Column="0" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,10,0,0">
            <StackPanel.Resources>
                <Style TargetType="FrameworkElement">
                    <Setter Property="Margin" Value="0,0,10,0"/>
                </Style>
            </StackPanel.Resources>
            <Button Content="图像重连" Click="refreshCamera" Height="20" Margin="0 0 5 0"/>
            <TextBlock VerticalAlignment="Center" Height="20" Margin="0">保存路径:</TextBlock>
            <TextBox Name="SavePathBox" Width="300" IsReadOnly="True" Height="20" Margin="0"/>
            <Button Content="选择路径" Click="SelectPathButton_Click" Height="20" Margin="0"/>
            <Button Content="截图" Click="CaptureButton_Click" Height="20" Margin="10 0 5 0"/>
            <Button x:Name="BtnAutoCaptureMenu" Content="自动截图" Click="BtnAutoCaptureMenu_Click"  Height="20" />
            <!-- 自动截图控制面板（默认隐藏） -->
            <StackPanel x:Name="AutoCapturePanel" Orientation="Vertical" Margin="10,5,0,0" Visibility="Collapsed">
                <StackPanel Orientation="Horizontal" Margin="0,5,0,5">
                    <TextBlock Text="截图间隔 (秒): " VerticalAlignment="Center"/>
                    <TextBox x:Name="TxtCaptureInterval" Width="80" Text="300" Margin="5,0,0,0"/>
                </StackPanel>

                <StackPanel Orientation="Horizontal" >
                    <Button x:Name="BtnStartAutoCapture" Content="开始自动截图" Width="120" Margin="0,0,10,0" Click="BtnStartAutoCapture_Click"/>
                    <Button x:Name="BtnStopAutoCapture" Content="结束自动截图" Width="120" Click="BtnStopAutoCapture_Click"/>
                </StackPanel>
            </StackPanel>
        </StackPanel>

        <StackPanel Grid.Row="0" Grid.Column="1" Orientation="Vertical" HorizontalAlignment="Center" >
            <!-- 串口面板 -->
            <TextBlock  FontSize="20" Margin="0 20 0 0">电机连接串口:</TextBlock>
            <ComboBox x:Name="cmbPorts" Width="120" Height="30" Margin="0 10 0 0"/>
            <Button x:Name="btnRefresh" Content="刷新" FontSize="20" Margin="0 20 0 00" Click="BtnRefresh_Click" Height="35" Width="100"/>
            <!-- 用水平StackPanel包裹按钮，让它们在同一行 -->
            <StackPanel Orientation="Horizontal" Margin="0 20 0 0" HorizontalAlignment="Center">
                <Button x:Name="btnConnect" Content="连接" FontSize="20" Click="BtnConnect_Click" Height="35" Width="100"/>
                <Button x:Name="btnDisconnect" Content="断开" FontSize="20" Margin="20 0 0 0" Click="BtnDisconnect_Click" Height="35" Width="100"/>
            </StackPanel>

            <!-- 电机移动步数核心控件：可编辑的ComboBox -->
            <TextBlock  FontSize="20" Margin="0 20 0 0">电机移动步数:</TextBlock>
            <ComboBox x:Name="editableComboBox" 
                      IsEditable="True"  
                      TextSearch.TextPath="Content"
                      StaysOpenOnEdit="True"
                      Width="100" FontSize="15" Margin="0 10 0 10">

                <!-- 预设选项 -->
                <ComboBoxItem Content="50" />
                <ComboBoxItem Content="200" />
                <ComboBoxItem Content="1000" />
            </ComboBox>
            <!-- 用水平StackPanel包裹电机控制按钮，让它们在同一行 -->
            <StackPanel Orientation="Horizontal" Margin="0 0 0 0" HorizontalAlignment="Center">
                <Button Content="前进" Click="Motor_Forward" FontSize="20" Margin="10" Height="35" Width="100"/>
                <Button Content="后退" Click="Motor_Backwards" FontSize="20" Margin="10" Height="35" Width="100"/>
            </StackPanel>
            <StackPanel Orientation="Horizontal" Margin="0 0 0 0" HorizontalAlignment="Center">
                <Button Content="停止" Click="Motor_Stop" FontSize="20" Margin="10" Height="35" Width="100"/>
                <Button Content="归位" Click="Motor_Home" FontSize="20" Margin="10" Height="35" Width="100"/>
            </StackPanel>
            <!-- 灯光控制 -->
            <Button Content="开灯" Click="LightOn" FontSize="20" Margin="0 30 0 10" Height="35" Width="100"/>
            <Button Content="关灯" Click="LightOff" FontSize="20" Margin="10" Height="35" Width="100"/>
            <!-- 图像增强调节 -->
            <GroupBox Header="图像增强参数" Margin="5" FontSize="20">
                <StackPanel>
                    <TextBlock Text="全局对比度 (Alpha)" Margin="0 20 0 10" />
                    <Slider x:Name="SliderAlpha" Minimum="1.0" Maximum="2.0" Value="1.5" TickFrequency="0.1" IsSnapToTickEnabled="True" ValueChanged="EnhancerParamsChanged"/>

                    <TextBlock Text="全局亮度偏移 (Beta)" Margin="0 20 0 10" />
                    <Slider x:Name="SliderBeta" Minimum="-50" Maximum="50" Value="-5" TickFrequency="1" IsSnapToTickEnabled="True" ValueChanged="EnhancerParamsChanged"/>

                    <TextBlock Text="CLAHE对比度限制 (ClipLimit)" Margin="0 20 0 10"/>
                    <Slider x:Name="SliderClipLimit" Minimum="1.0" Maximum="3.0" Value="2.0" TickFrequency="0.1" IsSnapToTickEnabled="True" ValueChanged="EnhancerParamsChanged"/>

                    <TextBlock Text="CLAHE网格大小 (TileGridSize)" Margin="0 20 0 10"/>
                    <ComboBox x:Name="ComboTileGridSize" SelectedIndex="0" SelectionChanged="ComboTileGridSize_SelectionChanged">
                        <ComboBoxItem Content="8x8" />
                        <ComboBoxItem Content="4x4" />
                        <ComboBoxItem Content="16x16" />
                    </ComboBox>

                    <TextBlock Text="伽马校正系数 (Gamma)" Margin="0 20 0 10"/>
                    <Slider x:Name="SliderGamma" Minimum="0.8" Maximum="1.5" Value="1.2" TickFrequency="0.05" IsSnapToTickEnabled="True" ValueChanged="EnhancerParamsChanged"/>
                    <!-- 启用锐化 -->
                    <CheckBox x:Name="ChkSharpen" Content="启用锐化" Checked="ChkSharpen_Checked" Unchecked="ChkSharpen_Checked" Margin="0,20"/>

                    <!-- 锐化强度 -->
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="锐化强度：" VerticalAlignment="Center"/>
                        <Slider x:Name="SliderSharpenStrength"
                          Minimum="0.1"
                          Maximum="1.0"
                          Value="0.5"
                          Width="150"
                          Margin="5,0"
                          ValueChanged="SliderSharpenStrength_ValueChanged"/>
                        <TextBlock x:Name="TxtSharpenValue" Text="0.5" VerticalAlignment="Center"/>
                    </StackPanel>
                </StackPanel>
            </GroupBox>

        </StackPanel>
        <!-- 右侧两个图表 -->
        <StackPanel Grid.Row="0" Grid.Column="2" Orientation="Vertical">

            <!-- CO2 图 -->
            <lvc:CartesianChart x:Name="Co2Chart"
                                Height="350"
                                Margin="20"
                                DisableAnimations="True"
                                LegendLocation="Right">
                <lvc:CartesianChart.AxisX>
                    <lvc:Axis Title="时间"
                              LabelFormatter="{Binding TimeFormatter}" />
                </lvc:CartesianChart.AxisX>
                <lvc:CartesianChart.AxisY>
                    <lvc:Axis Title="CO₂ (%)" MinValue="0" MaxValue="10"/>
                </lvc:CartesianChart.AxisY>
            </lvc:CartesianChart>

            <!-- 温度 图 -->
            <lvc:CartesianChart x:Name="TempChart"
                                Height="350"
                                Margin="20"
                                DisableAnimations="True"
                                LegendLocation="Right">
                <lvc:CartesianChart.AxisX>
                    <lvc:Axis Title="时间"
                              LabelFormatter="{Binding TimeFormatter}" />
                </lvc:CartesianChart.AxisX>
                <lvc:CartesianChart.AxisY>
                    <lvc:Axis Title="温度 (°C)" MinValue="10" MaxValue="50" />
                </lvc:CartesianChart.AxisY>
            </lvc:CartesianChart>

        </StackPanel>
    </Grid>
</Window>
